"use strict";var _async=require("./async");Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=buildAsyncQueueFactory,exports.AsyncQueue=void 0;class AsyncQueue{get promise(){return this._promise||Promise.resolve([])}constructor(){this.queue=new Set,this.flush=this.flush.bind(this),this.push=this.push.bind(this)}flush(){const a=[];return this.queue.forEach(b=>"function"==typeof b?a.push(b()):a.push(b)),this.queue.clear(),a.length?Promise.all(a):a}push(a){return 0===this.queue.size&&(this._promise=(0,_async.asynchronously)(this.flush)),this.queue.add(a),this._promise}}exports.AsyncQueue=AsyncQueue;function buildAsyncQueueFactory(){return new AsyncQueue}