"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.asynchronously=asynchronously,exports.default=buildAsyncQueueFactory,exports.AsyncQueue=void 0;function asynchronously(a,b){return new Promise(c=>{"function"==typeof process.nextTick?process.nextTick(()=>c(a(b))):"function"==typeof setImmediate?setImmediate(()=>c(a(b))):setTimeout(()=>c(a(b)))})}class AsyncQueue{get promise(){return this._promise||Promise.resolve([])}constructor(){this.queue=new Set,this.flush=this.flush.bind(this),this.push=this.push.bind(this)}flush(){const a=[];return this.queue.forEach(b=>"function"==typeof b?a.push(b()):a.push(b)),this.queue.clear(),a.length?Promise.all(a):a}push(a){return 0===this.queue.size&&(this._promise=asynchronously(this.flush)),this.queue.add(a),this._promise}}exports.AsyncQueue=AsyncQueue;function buildAsyncQueueFactory(){return new AsyncQueue}