"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;function defaultMiddlewareFind(a,b,c){const d=c.get(a);d instanceof Set&&d.forEach(a=>b.add(a))}function iterateEvents(a,b,c,d,e,f){Array.isArray(b)?b.forEach(b=>iterateEvents(a,b,c,d,e,f)):(f.pubchan.pipeline.ids.add(b),null===a(b,c,d,f)&&defaultMiddlewareFind(b,c,d),e.forEach((a,e)=>{a instanceof Set&&e(b,c,d,f)&&a.forEach(a=>c.add(a))}))}class PubChanMiddleware{constructor(a,b,c){this.pubchan=a,this.find=b||defaultMiddlewareFind,c&&(this.prepare=c)}match(a){const{listeners:b,fnlisteners:c,pipeline:d}=this.pubchan,{matches:e}=d;return this.prepare&&this.prepare(e,b,this),Array.isArray(a)&&a.length&&a.forEach(a=>{iterateEvents(this.find,a,e,b,c,this)}),e}}var _default=PubChanMiddleware;exports.default=_default;